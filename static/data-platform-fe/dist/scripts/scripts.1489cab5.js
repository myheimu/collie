"use strict";angular.module("dataPlatformApp",["ngRoute","ngSanitize","ui.bootstrap","ui.codemirror"]).config(["$routeProvider","$httpProvider",function(a,b){b.interceptors.push("authInterceptor"),a.when("/",{templateUrl:"views/recent.html",controller:"Recent"}).when("/create-table",{templateUrl:"views/create-table.html",controller:"CreateTable"}).when("/register-table",{templateUrl:"views/register-table.html",controller:"RegisterTable"}).when("/log-table/:id",{templateUrl:"views/register-table.html",controller:"RegisterTable"}).when("/create-table-success/:id",{templateUrl:"views/create-table-success.html",controller:"CreateTableSuccess"}).when("/table/:id",{templateUrl:"views/table.html",controller:"Table"}).when("/create-task",{templateUrl:"views/create-task.html",controller:"CreateTask"}).otherwise({redirectTo:"/"})}]).config(["$provide",function(a){a.decorator("$http",["$delegate",function(a){return a.$post=function(b,c){return a.post(b,$.param(c),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},a}])}]).controller("Sidebar",["$scope",function(a){a.productLine={}}]).controller("User",["$scope","User",function(a,b){b.info().success(function(b){a.user_info=b.user_info})}]).controller("Recent",["$scope","Table","$routeParams",function(a,b,c){a.isActive=function(a){return a==c.tab?!0:!1},b.latest().success(function(b){a.recentTables=b.tables}),b.getLogTableList().success(function(b){a.logTables=b.table_info_list})}]).controller("Table",["$scope","$routeParams","Table",function(a,b,c){c.get(b.id).success(function(b){a.table=b.table_info})}]).controller("CreateTable",["$scope","$routeParams","Table","$location","Common",function(a,b,c,d,e){a.fieldTypes=e.fieldTypes,a.table={columns:[{}],service_id:1},b.id&&c.get(id).success(function(b){a.table=b}),a.createTable=function(){c.create(a.table).success(function(a){d.path("/create-table-success/"+a.table_id)})}}]).controller("RegisterTable",["$scope","$routeParams","Table","$location","Common","editorOptions",function(a,b,c,d,e,f){a.editorOptions=f,a.fieldTypes=e.fieldTypes,b.id&&(a.viewTable=!0,c.getLogTable(b.id).success(function(b){a.table=b.table_info}));var g;a.edit=function(){a.editing=!0,g=angular.copy(a.table)},a.cancel=function(){a.editing=!1,a.table=g},a.file_format_option={"log-data":["sequence-file"],"temp-data":["parquet","textfile"]},a.deser_format_tips={delimited:'"delimited"="\\t","key"="value"',thrift:'serialization.class="",\nserialization.format=""'},a.$watch("table.data_type",function(b){"log-data"==b&&(a.table.file_type="sequence-file",a.table.deser_format="delimited",a.table.serde_params="",a.table.is_partition=!0),"temp-data"==b&&(a.table.file_type="parquet",a.table.is_partition=!1)}),a.$watch("table.name + table.data_type",function(){"log-data"==a.table.data_type&&(a.table.uri="/user/h_scribe/"+(a.table.name||"")),"temp-data"==a.table.data_type&&(a.table.uri="")}),a.submit=function(){c.register(a.table).success(function(b){return b.error_msg?void alert(b.error_msg):(a.editing=!1,void d.path("/log-table/"+b.table_info.id))})}}]).controller("CreateTableSuccess",["$scope","$routeParams",function(a,b){a.tableId=b.id}]).controller("CreateTask",["$scope",function(a){a.inputTables=[{}]}]).filter("emailName",function(){return function(a){return a.split("@")[0]}}).constant("Common",{fieldTypes:["bool","byte","i16","i32","i64","double","string","binary","slist"],BASE:""}).factory("User",["$http","Common",function(a,b){return{info:function(){return a.get(b.BASE+"/profile/nickname")}}}]).factory("Table",["$http","Common",function(a,b){return{latest:function(){return a.get(b.BASE+"/table/list/latest")},get:function(c){return a.get(b.BASE+"/table/describe?table_id="+c)},create:function(c){return a.$post(b.BASE+"/table/create",{table_info:JSON.stringify(c)})},register:function(c){return a.$post(b.BASE+"/table/register",{table_info:JSON.stringify(c)})},getLogTable:function(c){return a.get(b.BASE+"/table/log_table_info?table_id="+c)},getLogTableList:function(){return a.get(b.BASE+"/table/log_table_list")}}}]).factory("Task",["$http",function(){return{}}]).factory("authInterceptor",["$q",function(a){return{response:function(b){return/内网统一认证系统/.test(b.data)?(location.href="http://cas.mioffice.cn",a.reject()):b}}}]).constant("editorOptions",{lineNumbers:!0,indentWithTabs:!0,indentUnit:4,matchBrackets:!0,theme:"midnight",mode:"text/x-c++src"});